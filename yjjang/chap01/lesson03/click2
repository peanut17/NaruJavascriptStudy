Aì•ˆ] systemctl ëª…ë ¹ì„ sudo ì—†ì´ ì‚¬ìš©í•˜ê²Œ ì„¤ì •
ëª©í‘œ: ì¼ë°˜ ì‚¬ìš©ìê°€ clickhouse-server ì„œë¹„ìŠ¤ ì‹œì‘/ì •ì§€/ì¬ì‹œì‘ ê°€ëŠ¥

# rootì—ì„œ ì•„ë˜ ëª…ë ¹ ì‹¤í–‰
sudo visudo

# ë§¨ ì•„ë˜ì— ë‹¤ìŒ ë‚´ìš© ì¶”ê°€ (ì˜ˆ: user ì´ë¦„ì´ yjjangì¼ ê²½ìš°)
yjjang ALL=NOPASSWD: /bin/systemctl start clickhouse-server.service
yjjang ALL=NOPASSWD: /bin/systemctl stop clickhouse-server.service
yjjang ALL=NOPASSWD: /bin/systemctl restart clickhouse-server.service

ì´ì œ ì¼ë°˜ ì‚¬ìš©ìë¡œ ì „í™˜ í›„ ì•„ë˜ ëª…ë ¹ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥:
sudo /bin/systemctl start clickhouse-server.service


2. ì„¤ì • íŒŒì¼ ìˆ˜ì • ê¶Œí•œ ë¶€ì—¬
ClickHouse ì£¼ìš” ì„¤ì • íŒŒì¼:

íŒŒì¼	ìœ„ì¹˜
config.xml	/etc/clickhouse-server/config.xml
users.xml	/etc/clickhouse-server/users.xml

ê¸°ë³¸ì€ rootë§Œ ìˆ˜ì • ê°€ëŠ¥í•˜ë¯€ë¡œ ê¶Œí•œì„ ë¶€ì—¬í•´ì•¼ í•©ë‹ˆë‹¤.
# rootë¡œ ì‹¤í–‰
sudo chgrp -R clickhouse /etc/clickhouse-server
sudo chmod -R g+w /etc/clickhouse-server
sudo usermod -aG clickhouse yjjang
ğŸ” ì‹œìŠ¤í…œ ì¬ë¡œê·¸ì¸ í›„ ì ìš©ë¨ (groups ëª…ë ¹ìœ¼ë¡œ ê·¸ë£¹ í¬í•¨ ì—¬ë¶€ í™•ì¸ ê°€ëŠ¥)


3. ë°ì´í„° ë””ë ‰í† ë¦¬ ì ‘ê·¼ ê¶Œí•œ
ClickHouseëŠ” /var/lib/clickhouse ë“±ì— ë°ì´í„°ë¥¼ ì €ì¥í•¨

sudo chown -R clickhouse:clickhouse /var/lib/clickhouse
sudo chmod -R 770 /var/lib/clickhouse
ì‚¬ìš©ìê°€ clickhouse ê·¸ë£¹ì— í¬í•¨ë¼ ìˆë‹¤ë©´ ì ‘ê·¼ ê°€ëŠ¥

--------------------------------------------
ìˆ˜ì •í•´ì„œ ë‹¤ì‹œ ì‹¤í–‰í•´ë³´ì„¸ìš”

sudo /bin/systemctl start clickhouse-server.service
í˜¹ì€ /bin ìƒëµí•˜ê³  ì¼ë°˜ì ìœ¼ë¡œë„ ì˜ ë™ì‘í•©ë‹ˆë‹¤:

sudo systemctl start clickhouse-server.service


ì°¸ê³ : ì„œë¹„ìŠ¤ê°€ ì œëŒ€ë¡œ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´

systemctl status clickhouse-server.service
í˜¹ì€ ëª¨ë“  ìœ ë‹› ì¤‘ì— clickhouse ê´€ë ¨ëœ ê²ƒ ê²€ìƒ‰:

systemctl list-units --type=service | grep clickhouse

----------------------------------------------
. ì‚¬ìš©ì ê³„ì •ì˜ ê·¸ë£¹ ì ìš© ì—¬ë¶€ í™•ì¸
usermod -aG clickhouse yjjangì„ í•˜ì…¨ìœ¼ë©´ ë¡œê·¸ì•„ì›ƒ í›„ ì¬ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
ì•ˆ í•˜ë©´ clickhouse ê·¸ë£¹ì´ ì ìš©ë˜ì§€ ì•Šì•„ì„œ ê¶Œí•œì´ ì•ˆ ë¨¹ì–´ìš”.

í™•ì¸:
groups
ì¶œë ¥ì— clickhouseê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤:

yaml
yjjang : yjjang sudo clickhouse


2. ë””ë ‰í„°ë¦¬ ê¶Œí•œ ë° í¼ë¯¸ì…˜ ì¬í™•ì¸
í˜„ì¬ ê¶Œí•œ ìƒíƒœ í™•ì¸:

ls -ld /etc/clickhouse-server
ì •ìƒì ì´ë¼ë©´ ì´ëŸ° ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤:
drwxrwx---  4 root clickhouse 4096 Apr 22 12:00 /etc/clickhouse-server

ë§Œì•½ ê¶Œí•œì´ rwxê°€ ì•„ë‹ˆë¼ë©´ ìˆ˜ì •í•´ì£¼ì„¸ìš”:
sudo chmod 770 /etc/clickhouse-server

í•˜ìœ„ê¹Œì§€ í¬í•¨í•´ ì ‘ê·¼ë˜ê²Œ í•˜ë ¤ë©´:
sudo chmod -R g+rx /etc/clickhouse-server


3. í•´ë‹¹ ë””ë ‰í„°ë¦¬ì— ìˆëŠ” í•˜ìœ„ íŒŒì¼/ë””ë ‰í„°ë¦¬ì˜ ì†Œìœ ê¶Œê¹Œì§€ í™•ì¸
í•˜ìœ„ íŒŒì¼ë„ ì˜ëª»ëœ í¼ë¯¸ì…˜ìœ¼ë¡œ ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

find /etc/clickhouse-server ! -group clickhouse

â†’ ì¶œë ¥ë˜ëŠ” íŒŒì¼ì´ ìˆë‹¤ë©´ chgrpê°€ ì™„ì „íˆ ì•ˆ ë¨¹ì€ ê²ƒ â†’ ë‹¤ìŒ ëª…ë ¹ìœ¼ë¡œ ë‹¤ì‹œ ì ìš©:

sudo chgrp -R clickhouse /etc/clickhouse-server
sudo chmod -R g+rwX /etc/clickhouse-server
rwXëŠ” ë””ë ‰í„°ë¦¬ë©´ ì‹¤í–‰ê¶Œí•œ, íŒŒì¼ì´ë©´ ì½ê¸°/ì“°ê¸°ë§Œ ì¤ë‹ˆë‹¤ (ì•ˆì „í•˜ê²Œ ì ìš©ë¨)

4. í…ŒìŠ¤íŠ¸: ê¶Œí•œì´ ì˜ ë¨¹ì—ˆëŠ”ì§€ í™•ì¸
cd /etc/clickhouse-server
cat config.xml
ìœ„ ëª…ë ¹ì´ Permission denied ì—†ì´ ì˜ ì‹¤í–‰ë˜ë©´ ì„±ê³µì…ë‹ˆë‹¤.

5. ë§ˆë¬´ë¦¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

í•­ëª©	í™•ì¸ ì—¬ë¶€
clickhouse ê·¸ë£¹ì— í¬í•¨ëëŠ”ê°€ (groups)	âœ…
/etc/clickhouse-server ê¶Œí•œì´ 770 ì´ìƒì¸ê°€	âœ…
í•˜ìœ„ íŒŒì¼ ì†Œìœ  ê·¸ë£¹ë„ clickhouseì¸ê°€	âœ…
ì¬ë¡œê·¸ì¸ ë˜ëŠ” newgrp clickhouse í–ˆëŠ”ê°€

í˜¹ì‹œ ì¬ë¡œê·¸ì¸ì´ ì–´ë ¤ìš´ ìƒí™©ì´ë¼ë©´:
newgrp clickhouse
----------------------------------------------


1. í˜„ì¬ í¼ë¯¸ì…˜ ì§ì ‘ í™•ì¸

ls -ld /etc/clickhouse-server
ì¶œë ¥ ì˜ˆì‹œëŠ” ë‹¤ìŒì²˜ëŸ¼ ë‚˜ì™€ì•¼ ì •ìƒì…ë‹ˆë‹¤:


drwxrwx---  4 root clickhouse 4096 Apr 22 13:45 /etc/clickhouse-server
í¼ë¯¸ì…˜ì€ rwxrwx---

ê·¸ë£¹ì€ clickhouse

ì†Œìœ ìëŠ” ë³´í†µ rootì—¬ë„ ìƒê´€ì—†ìŠµë‹ˆë‹¤ (ì¤‘ìš”í•œ ê±´ ê·¸ë£¹)


2. í¼ë¯¸ì…˜ ìˆ˜ì • (ë””ë ‰í† ë¦¬ ì ‘ê·¼ ë¶ˆê°€ì¼ ê²½ìš°)
ì ‘ê·¼ì´ ì•ˆ ëœë‹¤ë©´, ë‹¤ìŒ ëª…ë ¹ìœ¼ë¡œ ê¶Œí•œ ë³´ì •:

sudo chgrp -R clickhouse /etc/clickhouse-server
sudo chmod -R g+rwX /etc/clickhouse-server
g+rwXëŠ” ë””ë ‰í† ë¦¬ì—ëŠ” x, íŒŒì¼ì—ëŠ” rw ê¶Œí•œì„ ê·¸ë£¹ì— ë¶€ì—¬í•©ë‹ˆë‹¤.

3. ë‹¤ì‹œ ì‹œë„
cd /etc/clickhouse-server
ë˜ëŠ” í…ŒìŠ¤íŠ¸ë¡œ íŒŒì¼ í•˜ë‚˜ ì½ì–´ë³´ê¸°:

cat /etc/clickhouse-server/config.xml

4. ê·¸ë˜ë„ ì•ˆ ëœë‹¤ë©´?
í˜¹ì‹œ ë¶€ëª¨ ë””ë ‰í† ë¦¬ ì¤‘ í•˜ë‚˜ê°€ ë§‰í˜€ ìˆëŠ”ì§€ë„ í™•ì¸í•´ë³´ì„¸ìš”:

ls -ld /etc
ì´ê²ƒë„ ìµœì†Œí•œ ì‹¤í–‰(x) ê¶Œí•œì´ ìˆì–´ì•¼ í•˜ë¯€ë¡œ drwxr-xr-x ì´ìƒì´ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

----------------------------------------------

ì•„ë˜ ì´ ë‚´ìš©ì„ ë³´ì‹œë©´ ë°”ë¡œ ì•Œ ìˆ˜ ìˆì–´ìš”:

drwx-w---- 4 clickhouse clickhouse 4096 Mar 18 12:37 /etc/clickhouse-server
ì´ ë””ë ‰í† ë¦¬ëŠ” í˜„ì¬ í¼ë¯¸ì…˜ì´ drwx-w----, ì¦‰:

ì½ê¸°(r) ê¶Œí•œ âŒ ì—†ìŒ

ì“°ê¸°(w) ê¶Œí•œ âœ… ìˆìŒ

ì‹¤í–‰(x) ê¶Œí•œ âŒ ì—†ìŒ (â†’ ë””ë ‰í„°ë¦¬ ì ‘ê·¼ ë¶ˆê°€)


ë””ë ‰í† ë¦¬ì— x(execute) ê¶Œí•œì´ ì—†ìœ¼ë©´ cdê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤!

í•´ê²° ë°©ë²•
x ê¶Œí•œì„ ê·¸ë£¹ì— ì¶”ê°€í•´ì¤ë‹ˆë‹¤:

sudo chmod g+x /etc/clickhouse-server
ê·¸ëŸ¬ë©´ í¼ë¯¸ì…˜ì´ ì´ë ‡ê²Œ ë°”ë€ë‹ˆë‹¤:

drwxrwx--- 4 clickhouse clickhouse 4096 Mar 18 12:37 /etc/clickhouse-server
ì´í›„ ë‹¤ì‹œ ì‹œë„:

cd /etc/clickhouse-server

ì¶”ê°€ë¡œ: ì „ì²´ í•˜ìœ„ ê²½ë¡œì—ë„ ê¶Œí•œ ì¼ê´„ ë¶€ì—¬ (ì•ˆì „í•˜ê²Œ)

sudo chmod -R g+rwX /etc/clickhouse-server
g+rwXëŠ” ë””ë ‰í† ë¦¬ì—ëŠ” x, íŒŒì¼ì—ëŠ” rwë¥¼ ì¤˜ì„œ ì•ˆì „í•˜ê²Œ í¼ë¯¸ì…˜ ì •ë¦¬í•©ë‹ˆë‹¤.


----------------------------------------------

clickhouse-client ëª…ë ¹ì–´ì—ì„œ "sudo password is required" ë©”ì‹œì§€ê°€ ë‚˜ì˜¤ëŠ” ì´ìœ ëŠ” í¬ê²Œ 2ê°€ì§€ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤:

âœ… 1. clickhouse-client ìì²´ê°€ sudoë¡œ ì‹¤í–‰ë˜ë„ë¡ alias ë˜ëŠ” ì„¤ì •ëœ ê²½ìš°
ìš°ì„  ì•„ë˜ ëª…ë ¹ìœ¼ë¡œ í™•ì¸í•´ë³´ì„¸ìš”:
type clickhouse-client

ì •ìƒì´ë¼ë©´:
clickhouse-client is /usr/bin/clickhouse-client

ë¹„ì •ìƒ ì˜ˆì‹œ (ì›ì¸):
clickhouse-client is aliased to `sudo /usr/bin/clickhouse-client`

í•´ê²° ë°©ë²•
ë§Œì•½ alias ë˜ì–´ ìˆë‹¤ë©´:
unalias clickhouse-client

ê·¸ë¦¬ê³  .bashrc ë˜ëŠ” .zshrc ë“± ì‰˜ ì„¤ì • íŒŒì¼ì— ì•„ë˜ ì¤„ì´ ìˆë‹¤ë©´ ì‚­ì œí•˜ì„¸ìš”:
alias clickhouse-client='sudo /usr/bin/clickhouse-client'

ì‚­ì œ í›„:
source ~/.bashrc  # or ~/.zshrc



2. /usr/bin/clickhouse-client ë°”ì´ë„ˆë¦¬ ìì²´ê°€ root ê¶Œí•œì´ í•„ìš”í•˜ë„ë¡ ì„¤ì •ëœ ê²½ìš°
ì´ê±´ ë“œë¬¼ì§€ë§Œ ê°€ëŠ¥ì„± ìˆìŠµë‹ˆë‹¤. í™•ì¸í•´ë³´ì„¸ìš”:

ls -l /usr/bin/clickhouse-client
ì¶œë ¥ ì˜ˆì‹œ:
-rwxr-xr-x 1 root root 9000000 Apr 15 10:00 /usr/bin/clickhouse-client
ì´ê±´ ì •ìƒì…ë‹ˆë‹¤.

âš  ë°˜ë©´ì— ë§Œì•½ -rwsr-xr-x ì²˜ëŸ¼ setuid(s) ë¹„íŠ¸ê°€ ìˆê±°ë‚˜, ì†Œìœ ìê°€ ì´ìƒí•˜ê²Œ ë˜ì–´ ìˆë‹¤ë©´ ìˆ˜ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ”§ ê¶Œí•œ ìˆ˜ì • ì˜ˆì‹œ
sudo chown root:root /usr/bin/clickhouse-client
sudo chmod 755 /usr/bin/clickhouse-client
ê·¸ í›„, ì¼ë°˜ ì‚¬ìš©ìë¡œ ì‹¤í–‰:

clickhouse-client





