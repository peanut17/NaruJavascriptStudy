â–¶ï¸ Step 3: ìˆ˜ë™ ì—…ê·¸ë ˆì´ë“œ (íì‡„ë§ ë˜ëŠ” íŠ¹ì • ë²„ì „ í•„ìš” ì‹œ)
ClickHouse ê³µì‹ DEB ì €ì¥ì†Œì—ì„œ ìµœì‹  .deb 3ì¢… ë‹¤ìš´ë¡œë“œ

ê¸°ì¡´ ë²„ì „ ì œê±° (ë°ì´í„° ì‚­ì œ ì•ˆ ë¨):

bash
ë³µì‚¬
í¸ì§‘
sudo dpkg -r clickhouse-server clickhouse-client clickhouse-common-static
ìƒˆ ë²„ì „ ì„¤ì¹˜:

bash
ë³µì‚¬
í¸ì§‘
sudo dpkg -i clickhouse-common-static_XX.deb
sudo dpkg -i clickhouse-client_XX.deb
sudo dpkg -i clickhouse-server_XX.deb


4. ì—…ê·¸ë ˆì´ë“œ í›„ í™•ì¸
bash
ë³µì‚¬
í¸ì§‘
sudo service clickhouse-server restart
clickhouse-client
SELECT version();
ë¬¸ì œ ì—†ì´ ì ‘ì†ë˜ê³  ë²„ì „ì´ ì˜¬ë¼ê°”ë‹¤ë©´ ì„±ê³µì…ë‹ˆë‹¤.

âœ… 5. ë°ì´í„° í™•ì¸ ë° ì ê²€
ê¸°ì¡´ í…Œì´ë¸” ì¡°íšŒ:

bash
ë³µì‚¬
í¸ì§‘
SHOW TABLES;
ë°ì´í„° ì¡°íšŒ:

bash
ë³µì‚¬
í¸ì§‘
SELECT COUNT(*) FROM my_table;
ì´ìƒ ì—†ë‹¤ë©´ ì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ëœ ê²ë‹ˆë‹¤.

í•„ìš”í•˜ë‹¤ë©´:

íŠ¹ì • ë²„ì „ ì—…ê·¸ë ˆì´ë“œ ë°©ë²•

íì‡„ë§ í™˜ê²½ ì—…ê·¸ë ˆì´ë“œ ë°©ì‹ (USBë¡œ .deb ì˜®ê¸°ëŠ” ë°©ì‹)

ë°±ì—… ìë™í™” ìŠ¤í¬ë¦½íŠ¸

ë„ ë„ì™€ë“œë¦´ ìˆ˜ ìˆì–´ìš”. ìš°ë¶„íˆ¬ ë²„ì „ê³¼ ClickHouse í˜„ì¬/ì—…ê·¸ë ˆì´ë“œ í¬ë§ ë²„ì „ ì•Œë ¤ì£¼ì‹œë©´ ë” êµ¬ì²´ì ìœ¼ë¡œ ë„ì™€ë“œë¦´ê²Œìš”.





dpkg -r clickhouse-server clickhouse-client clickhouse-common-static ëª…ë ¹ì„ ì‹¤í–‰í•œ ë’¤, ì‹¤ì œë¡œ íŒ¨í‚¤ì§€ê°€ ì‚­ì œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤:

âœ… 1. ì„¤ì¹˜ ì—¬ë¶€ í™•ì¸ ëª…ë ¹ì–´
bash
ë³µì‚¬
í¸ì§‘
dpkg -l | grep clickhouse
ğŸ” ì¶œë ¥ ì˜ˆì‹œ:
ì‚­ì œ ì•ˆ ëœ ê²½ìš°:

cpp
ë³µì‚¬
í¸ì§‘
ii  clickhouse-client       23.3.1.2820     amd64        ClickHouse client
ii  clickhouse-server       23.3.1.2820     amd64        ClickHouse server
ii  clickhouse-common-static 23.3.1.2820    amd64        ClickHouse common static binaries
â†’ iiëŠ” ì„¤ì¹˜ëœ ìƒíƒœë¥¼ ì˜ë¯¸ (installed)

ì‚­ì œëœ ê²½ìš°:
ì•„ë¬´ ì¶œë ¥ë„ ì—†ê±°ë‚˜ rcì²˜ëŸ¼ ë‚˜ì˜¤ë©´ ì‚­ì œëœ ê²ƒ

pgsql
ë³µì‚¬
í¸ì§‘
rc  clickhouse-server       23.3.1.2820     amd64        ClickHouse server
âœ… 2. íŒ¨í‚¤ì§€ íŒŒì¼ ìì²´ê°€ ì§€ì›Œì¡ŒëŠ”ì§€ í™•ì¸
bash
ë³µì‚¬
í¸ì§‘
which clickhouse-client
ì‚­ì œëœ ê²½ìš°: ì¶œë ¥ ì—†ìŒ

ì„¤ì¹˜ëœ ê²½ìš°: /usr/bin/clickhouse-client ë“± ì¶œë ¥ë¨

ë˜ëŠ”:

bash
ë³µì‚¬
í¸ì§‘
ls /usr/bin/clickhouse*
â†’ ëª…ë ¹ì–´ë“¤ì´ ë‚¨ì•„ ìˆë‹¤ë©´ ì™„ì „íˆ ì œê±°ë˜ì§€ ì•Šì€ ê²ƒì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

âœ… 3. ì„œë¹„ìŠ¤ê°€ ì—¬ì „íˆ ì‚´ì•„ìˆëŠ”ì§€ í™•ì¸
bash
ë³µì‚¬
í¸ì§‘
systemctl status clickhouse-server
ì‚­ì œ í›„ì—ë„ ì„œë¹„ìŠ¤ íŒŒì¼ì´ ì‚´ì•„ ìˆë‹¤ë©´ ìˆ˜ë™ ì •ë¦¬ê°€ í•„ìš”í•  ìˆ˜ ìˆì–´ìš”.

âœ… 4. ì™„ì „ ì‚­ì œí•˜ê³  ì‹¶ë‹¤ë©´?
bash
ë³µì‚¬
í¸ì§‘
sudo dpkg -P clickhouse-server clickhouse-client clickhouse-common-static
ë˜ëŠ” ì„¤ì • íŒŒì¼ê¹Œì§€ ë‹¤ ì •ë¦¬í•˜ë ¤ë©´:

bash
ë³µì‚¬
í¸ì§‘
sudo apt purge clickhouse-server clickhouse-client clickhouse-common-static
sudo rm -rf /etc/clickhouse* /var/lib/clickhouse /var/log/clickhouse*
âš ï¸ ì´ ëª…ë ¹ì€ ë°ì´í„°ê¹Œì§€ ì‚­ì œí•˜ë‹ˆ ì—…ê·¸ë ˆì´ë“œê°€ ëª©ì ì´ë¼ë©´ ì‚¬ìš© ê¸ˆì§€ì…ë‹ˆë‹¤.





âœ… í•µì‹¬ ì„±ëŠ¥ ìµœì í™” ì˜µì…˜ ìš”ì•½
ì˜µì…˜ëª…	ê¸°ë³¸ê°’	ì„¤ëª…
query_plan_optimize_lazy_materialization	0	í•„ìš”í•œ ì—´ë§Œ ë‚˜ì¤‘ì— materialize â†’ SELECT *, ORDER BY, LIMIT ì¡°í•©ì— í•„ìˆ˜
optimize_read_in_order	1	ORDER BYê°€ í…Œì´ë¸” ì •ë ¬ í‚¤ì™€ ê°™ì„ ë•Œ ì •ë ¬ ì—†ì´ ì½ë„ë¡ ìµœì í™”
optimize_read_in_window_order	1	ìœˆë„ìš° í•¨ìˆ˜ì— ORDER BYê°€ ìˆìœ¼ë©´ ì •ë ¬ ì—†ì´ ì½ë„ë¡ ìµœì í™”
join_algorithm	auto	grace_hash, partial_merge, hash ë“± ìë™ ì„ íƒ â†’ ëŒ€ìš©ëŸ‰ JOIN ì²˜ë¦¬ ìµœì í™”
max_threads	ì„œë²„ ì½”ì–´ ìˆ˜	ë³‘ë ¬ ì²˜ë¦¬ ìµœëŒ€ ìŠ¤ë ˆë“œ ìˆ˜ ì„¤ì • â†’ ì½”ì–´ ìˆ˜ì— ë§ì¶° ì¡°ì ˆí•˜ë©´ ì†ë„ í–¥ìƒ
max_bytes_before_external_group_by	0	GROUP BY ê²°ê³¼ê°€ ì´ ì´ìƒì´ë©´ ë””ìŠ¤í¬ spill ì‚¬ìš© â†’ Out-of-Memory ë°©ì§€
group_by_two_level_threshold	1000000	GROUP BY key ìˆ˜ê°€ ì´ ìˆ˜ ì´ìƒì´ë©´ two-level group by ì ìš© (ë” ë¹ ë¦„)
optimize_aggregation_in_order	0	ORDER BYì— ê¸°ë°˜í•œ ì •ë ¬ëœ ìƒíƒœì—ì„œì˜ ì§‘ê³„ ìµœì í™”
enable_distributed_aggregation_memory_efficient	0	ë¶„ì‚° ì¿¼ë¦¬ ì‹œ ë©”ëª¨ë¦¬ ì¹œí™”ì ì¸ ë°©ì‹ ì‚¬ìš©
distributed_group_by_no_merge	0	ê° shardì—ì„œ aggregation í›„ central merge ìƒëµ â†’ ì¼ë¶€ ë¶„ì„ ì¿¼ë¦¬ì—ì„œ ë¹ ë¦„

âœ… ì‹¤ì „ ì ìš© ì˜ˆì‹œ
sql
ë³µì‚¬
í¸ì§‘
SET query_plan_optimize_lazy_materialization = 1;
SET optimize_read_in_order = 1;
SET optimize_aggregation_in_order = 1;
SET join_algorithm = 'auto';
SET max_threads = 8;  -- CPU ìˆ˜ì— ë”°ë¼ ì¡°ì ˆ
SET group_by_two_level_threshold = 1000000;
âœ… ì¿¼ë¦¬ í”Œë˜ë„ˆ í™•ì¸
ì˜µì…˜ ì ìš©ì´ ì‹¤ì œ íš¨ê³¼ë¥¼ ë³´ëŠ”ì§€ í™•ì¸í•˜ë ¤ë©´ EXPLAIN ë˜ëŠ” EXPLAIN PIPELINE ì‚¬ìš©:

sql
ë³µì‚¬
í¸ì§‘
EXPLAIN PIPELINE
SELECT ...
FROM big_table
JOIN ...
ORDER BY created_at DESC
LIMIT 100;
âœ… ì¶”ê°€ ì¶”ì²œ: í…Œì´ë¸” êµ¬ì¡° + ì—”ì§„ íŠœë‹
ì „ëµ	ì„¤ëª…
MergeTreeì˜ ORDER BY í‚¤ íŠœë‹	ìì£¼ ì“°ëŠ” WHERE, ORDER BY, JOIN ì»¬ëŸ¼ ìœ„ì£¼ë¡œ êµ¬ì„±
TTLë¡œ ì˜¤ë˜ëœ ë°ì´í„° ìë™ ì •ë¦¬	ì¿¼ë¦¬ ëŒ€ìƒ ë°ì´í„° ê°ì†Œ
Materialized View ì‚¬ìš©	ë³µì¡í•œ ì¡°ì¸/ì§‘ê³„ ê²°ê³¼ë¥¼ ë¯¸ë¦¬ ì €ì¥í•´ ë¹ ë¥´ê²Œ ì¡°íšŒ
CollapsingMergeTree, ReplacingMergeTree	ìµœì‹  ìƒíƒœë§Œ ìœ ì§€í•  ë•Œ ìœ ë¦¬í•œ ì—”ì§„
Dictionary + JOIN	í° dimension í…Œì´ë¸”ì€ dictionaryë¡œ ì¹˜í™˜í•´ì„œ ë¹ ë¥¸ lookup

âœ… ë§ˆë¬´ë¦¬ ìš”ì•½
ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ë¹ ë¥´ê²Œ í•˜ë ¤ë©´:

query_plan_optimize_lazy_materialization = 1 ê¼­ ì¼œê¸°

JOIN, ORDER BY, GROUP BY ê´€ë ¨ ì˜µì…˜ ìµœì í™”

max_threads, group_by_two_level_threshold ë“± ìì› ê¸°ë°˜ ì¡°ì •

ì¿¼ë¦¬ í”Œëœì„ í•­ìƒ EXPLAINìœ¼ë¡œ í™•ì¸

í…Œì´ë¸” ìì²´ì˜ ORDER BY, íŒŒí‹°ì…”ë‹, ì—”ì§„ êµ¬ì¡°ë„ ë³‘í–‰ ì¡°ì •


