sudo dpkg -i grafana_11.2.0_amd64.deb
# ì˜ì¡´ì„± ë¬¸ì œ ìˆìœ¼ë©´:
sudo apt-get -f install


sudo systemctl enable grafana-server
sudo systemctl start grafana-server
sudo systemctl status grafana-server

ì ‘ì†: http://<VM_IP>:3000 (ê¸°ë³¸ ë¡œê·¸ì¸: admin / admin)


3. í”ŒëŸ¬ê·¸ì¸/ëŒ€ì‹œë³´ë“œ ì˜¤í”„ë¼ì¸ ì„¤ì¹˜

ì¸í„°ë„·ì´ ì•ˆ ë˜ë¯€ë¡œ í”ŒëŸ¬ê·¸ì¸ì´ë‚˜ ëŒ€ì‹œë³´ë“œ JSONì€ ì˜¨ë¼ì¸ PCì—ì„œ ë¯¸ë¦¬ ë°›ì•„ì•¼ í•©ë‹ˆë‹¤.

Grafana Marketplaceì—ì„œ JSON ë‹¤ìš´ë¡œë“œ â†’ ì˜¤í”„ë¼ì¸ ì„œë²„ì˜ /var/lib/grafana/dashboards/ ì— ë³µì‚¬ â†’ Grafana UIì—ì„œ import.





. í™•ì¸: Prometheusê°€ ClickHouse ë©”íŠ¸ë¦­ì„ ê¸ì–´ì˜¤ëŠ”ì§€

Prometheus ì„¤ì •(prometheus.yml)ì— ì´ë¯¸ ë“¤ì–´ìˆì–´ì•¼ í•©ë‹ˆë‹¤:

scrape_configs:
  - job_name: 'clickhouse_native'
    static_configs:
      - targets: ['192.168.173.130:9363']   # VM IP


í™•ì¸:

http://<Prometheus_IP>:9090/targets â†’ clickhouse_native ìƒíƒœê°€ UP ì¸ì§€

http://<Prometheus_IP>:9090/graph â†’ ì˜ˆ: clickhouse_asynchronous_metrics_MemoryResident

2. Grafanaì—ì„œ Prometheus ì—°ê²°

Grafana ì ‘ì† â†’ http://<Grafana_IP>:3000

ë¡œê·¸ì¸ (admin/admin)

Connections â†’ Data sources â†’ Add data source â†’ Prometheus ì„ íƒ

URL: http://<Prometheus_IP>:9090

Save & Test â†’ â€œData source is workingâ€ ë‚˜ì˜¤ë©´ OK

3. ìƒˆ ëŒ€ì‹œë³´ë“œ ìƒì„± + íŒ¨ë„ ì¶”ê°€

ì™¼ìª½ ë©”ë‰´ â†’ ğŸ“Š Dashboards â†’ New â†’ New Dashboard

Add a new panel í´ë¦­

ì¿¼ë¦¬ ì…ë ¥ë€ì— PromQL ì‘ì„±:

clickhouse_asynchronous_metrics_MemoryResident / 1024^3


ğŸ‘‰ ClickHouse í”„ë¡œì„¸ìŠ¤ì˜ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰(GB)

Visualization â†’ Time series ì„ íƒ

ì˜¤ë¥¸ìª½ì—ì„œ ê·¸ë˜í”„ ì œëª©/ë‹¨ìœ„(GB) ë“± ì„¤ì •

4. ì €ì¥ ë° í™•ì¸

ìƒë‹¨ â†’ Save Dashboard

ì´ì œ ClickHouse ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ì‹œê°„ì¶• ê·¸ë˜í”„ë¡œ í‘œì‹œë©ë‹ˆë‹¤.

5. ì¶”ê°€ ì˜ˆì‹œ (ìì£¼ ì“°ëŠ” ê·¸ë˜í”„)

í˜¸ìŠ¤íŠ¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  (%)

100 * (1 - clickhouse_asynchronous_metrics_OSMemoryAvailable / clickhouse_asynchronous_metrics_OSMemoryTotal)


ì¿¼ë¦¬ ì‹¤í–‰ íšŸìˆ˜(ì´ˆë‹¹)

rate(clickhouse_events_Query[1m])


CPU ì‚¬ìš©ë¥  (%)

100 * (1 - avg_over_time(clickhouse_asynchronous_metrics_OSIdleTimeNormalized[1m]))


ğŸ‘‰ ì´ë ‡ê²Œ í•˜ë©´ ClickHouse â†’ Prometheus â†’ Grafana ì²´ì¸ì´ ì™„ì„±ë¼ì„œ ì›í•˜ëŠ” ì§€í‘œë¥¼ ê·¸ë˜í”„ë¡œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.

ì›í•˜ì‹œë©´ ì œê°€ ClickHouse ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ JSON í…œí”Œë¦¿(ë©”ëª¨ë¦¬/CPU/ì¿¼ë¦¬ ì´ë²¤íŠ¸ 3ê°œ íŒ¨ë„ í¬í•¨)ì„ ë°”ë¡œ ë“œë ¤ì„œ Grafanaì—ì„œ Importë§Œ í•˜ë©´ ë‚˜ì˜¤ê²Œ í•´ë“œë¦´ê¹Œìš”?

ë‚˜ì˜ ë§:
ClickHouse ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ JSON í…œí”Œë¦¿(ë©”ëª¨ë¦¬/CPU/ì¿¼ë¦¬ ì´ë²¤íŠ¸ 3ê°œ íŒ¨ë„ í¬í•¨)ì„ ë°”ë¡œ ë“œë ¤ì„œ Grafanaì—ì„œ Importë§Œ í•˜ë©´ ë‚˜ì˜¤ê²Œ í•´ì¤˜
ChatGPTì˜ ë§:
14s ë™ì•ˆ ìƒê°í•¨

ì•Œê² ì–´ìš”! ì•„ë˜ Grafana ëŒ€ì‹œë³´ë“œ JSONì„ ê·¸ëŒ€ë¡œ Import í•˜ë©´,
Prometheusì—ì„œ ìˆ˜ì§‘í•œ ClickHouse ë©”íŠ¸ë¦­ìœ¼ë¡œ ë©”ëª¨ë¦¬ / CPU / ì¿¼ë¦¬ QPS 3ê°œ íŒ¨ë„ì´ ë°”ë¡œ ëœ¹ë‹ˆë‹¤.

ì‚¬ìš© ë°©ë²•

Grafana â†’ Dashboards â†’ Import

ì•„ë˜ JSONì„ ë¶™ì—¬ë„£ê³  â†’ Prometheus ë°ì´í„°ì†ŒìŠ¤ ì„ íƒ â†’ Import

ëŒ€ì‹œë³´ë“œ ìƒë‹¨ì˜ instance ë“œë¡­ë‹¤ìš´ìœ¼ë¡œ íŠ¹ì • ë…¸ë“œë¥¼ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”.

{
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "panels": [
    {
      "type": "timeseries",
      "title": "ClickHouse Memory (GB)",
      "id": 1,
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_PROMETHEUS}"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "clickhouse_asynchronous_metrics_MemoryResident{instance=~\"$instance\"} / 1024^3",
          "legendFormat": "{{instance}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "gbytes",
          "decimals": 2
        },
        "overrides": []
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      }
    },
    {
      "type": "timeseries",
      "title": "CPU Usage (%)",
      "id": 2,
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_PROMETHEUS}"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "100 * (1 - avg_over_time(clickhouse_asynchronous_metrics_OSIdleTimeNormalized{instance=~\"$instance\"}[1m]))",
          "legendFormat": "{{instance}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1,
          "min": 0,
          "max": 100
        },
        "overrides": []
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Queries per Second (QPS)",
      "id": 3,
      "datasource": {
        "type": "prometheus",
        "uid": "${DS_PROMETHEUS}"
      },
      "targets": [
        {
          "refId": "A",
          "expr": "sum(rate(clickhouse_events_Query{instance=~\"$instance\"}[1m])) by (instance)",
          "legendFormat": "{{instance}}"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ops",
          "decimals": 2
        },
        "overrides": []
      },
      "options": {
        "legend": {
          "displayMode": "table",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      }
    }
  ],
  "templating": {
    "list": [
      {
        "type": "query",
        "name": "instance",
        "label": "Instance",
        "hide": 0,
        "datasource": {
          "type": "prometheus",
          "uid": "${DS_PROMETHEUS}"
        },
        "refresh": 1,
        "query": {
          "query": "label_values(up{job=\"clickhouse_native\"}, instance)"
        },
        "includeAll": true,
        "multi": true,
        "current": {
          "selected": false,
          "text": "All",
          "value": ".*"
        },
        "regex": "",
        "sort": 1,
        "options": []
      }
    ]
  },
  "title": "ClickHouse â€” Minimal Ops (Memory / CPU / QPS)",
  "timezone": "",
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "schemaVersion": 39,
  "version": 1,
  "editable": true,
  "refresh": "10s"
}


ì›í•˜ë©´ ì—¬ê¸°ì„œ ë””ìŠ¤í¬ ì‚¬ìš©ëŸ‰/IO, ìºì‹œ(Mark/Uncompressed), ë ˆí”Œë¦¬ì¼€ì´ì…˜ ìƒíƒœ ë“±ë„ íŒ¨ë„ë¡œ ë” ë¶™ì—¬ì„œ ë“œë¦´ ìˆ˜ ìˆì–´ìš”.
