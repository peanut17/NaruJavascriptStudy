1. μΏΌλ¦¬μ λ©”λ¨λ¦¬ μ”κµ¬μ‚¬ν•­ ν™•μΈ
Impala Web UI λλ” Query Profileμ„ μ‚¬μ©ν•΄ μΏΌλ¦¬μ λ©”λ¨λ¦¬ μ”κµ¬μ‚¬ν•­μ„ λ¶„μ„ν•©λ‹λ‹¤.
Query Profileμ—μ„ Per Node Peak Memory Usage κ°’μ„ ν™•μΈν•μ—¬ κ° λ…Έλ“μ—μ„ μ”κµ¬λλ” μµλ€ λ©”λ¨λ¦¬λ¥Ό νμ•…ν•μ„Έμ”.
2. μΏΌλ¦¬ μµμ ν™”
μΏΌλ¦¬ μ”κµ¬ λ©”λ¨λ¦¬λ¥Ό μ¤„μ΄κΈ° μ„ν•΄ μΏΌλ¦¬λ¥Ό μµμ ν™”ν•  μ μμµλ‹λ‹¤:

SELECT λ²”μ„ μ¶•μ†: ν•„μ”ν• λ°μ΄ν„°λ§ κ°€μ Έμ¤λ” μΏΌλ¦¬λ¥Ό μ‘μ„±ν•©λ‹λ‹¤.
JOIN μ „λµ λ³€κ²½:
ν° ν…μ΄λΈ”μ κ²½μ°, Broadcast Join λ€μ‹  Partitioned Joinμ„ μ‚¬μ©ν•μ„Έμ”.
μ‘μ€ ν…μ΄λΈ”μ κ²½μ°, Broadcast Joinμ„ μ μ§€ν•λ” κ²ƒμ΄ λ” ν¨μ¨μ μ…λ‹λ‹¤.
LIMIT μ¶”κ°€: ν…μ¤νΈ μ¤‘μ΄λΌλ©΄ μΏΌλ¦¬μ— LIMITμ„ μ¶”κ°€ν•μ—¬ μ²λ¦¬ λ°μ΄ν„°λ¥Ό μ¤„μ…λ‹λ‹¤.
νν‹°μ… ν•„ν„°λ§: ν•„μ”ν• νν‹°μ…λ§ μ¤μΊ”ν•λ„λ΅ μΏΌλ¦¬λ¥Ό μ‘μ„±ν•©λ‹λ‹¤.
3. λ¦¬μ†μ¤ ν’€ λ©”λ¨λ¦¬ μ„¤μ • μ΅°μ •
μΏΌλ¦¬ μ”κµ¬μ‚¬ν•­μ— λ§κ² λ¦¬μ†μ¤ ν’€μ λ©”λ¨λ¦¬λ¥Ό λλ¦΄ μ μμµλ‹λ‹¤:

ν„μ¬ μ„¤μ • ν™•μΈ

sql
μ½”λ“ λ³µμ‚¬
SHOW POOL CONFIGS 'root.default';
μ¶λ ¥ κ²°κ³Όμ—μ„ max_mem_resources κ°’μ„ ν™•μΈν•μ„Έμ”.

λ¦¬μ†μ¤ ν’€ λ©”λ¨λ¦¬ μ¦κ°€ Cloudera Manager λλ” λ…λ Ήμ–΄λ΅ λ©”λ¨λ¦¬ ν•λ„λ¥Ό λλ¦΄ μ μμµλ‹λ‹¤:

Cloudera Manager:
Impala > Configuration > Resource Managementμ—μ„ ν•΄λ‹Ή λ¦¬μ†μ¤ ν’€μ„ μ°Ύμ•„ Max Memory κ°’μ„ μ¦κ°€μ‹ν‚µλ‹λ‹¤.
λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•΄ μ¦‰μ‹ μ μ©:
sql
μ½”λ“ λ³µμ‚¬
ALTER RESOURCE POOL root.default SET max_mem_resources='1TB';
λ³€κ²½ν• κ°’μ€ μΏΌλ¦¬κ°€ μ”κµ¬ν•λ” λ©”λ¨λ¦¬(μ: 966.36GB)λ³΄λ‹¤ μ»¤μ•Ό ν•©λ‹λ‹¤.

4. ν΄λ¬μ¤ν„° μμ› κ²€ν† 
λ¦¬μ†μ¤ ν’€ λ©”λ¨λ¦¬λ¥Ό λλ¦΄ μ μ—†λ” κ²½μ°, ν΄λ¬μ¤ν„°μ μ „μ²΄ λ©”λ¨λ¦¬ λ¦¬μ†μ¤λ¥Ό κ²€ν† ν•©λ‹λ‹¤:

Impala λ°λ¬μ mem_limitμ„ λλ¦½λ‹λ‹¤:
Cloudera Managerμ—μ„ Impala Daemon Memory Limit μ„¤μ •μ„ μ΅°μ •ν•©λ‹λ‹¤.
ν΄λ¬μ¤ν„°μ— λ…Έλ“λ¥Ό μ¶”κ°€ν•μ—¬ μ „μ²΄ λ©”λ¨λ¦¬λ¥Ό ν™•μ¥ν•©λ‹λ‹¤.
5. μΏΌλ¦¬ μ‹¤ν–‰ ν…μ¤νΈ
μ„¤μ •μ„ μ΅°μ •ν• ν›„ μΏΌλ¦¬λ¥Ό λ‹¤μ‹ μ‹¤ν–‰ν•μ—¬ λ¬Έμ κ°€ ν•΄κ²°λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤:

sql
μ½”λ“ λ³µμ‚¬
EXPLAIN <query>;
EXPLAIN κ²°κ³Όλ¥Ό ν†µν•΄ μμƒ λ©”λ¨λ¦¬ μ‚¬μ©λ‰κ³Ό μΏΌλ¦¬ κ³„νμ„ ν™•μΈν•μ„Έμ”.

μ”μ•½
μΏΌλ¦¬ μµμ ν™”λ΅ λ©”λ¨λ¦¬ μ”κµ¬μ‚¬ν•­μ„ μ¤„μ…λ‹λ‹¤.
λ¦¬μ†μ¤ ν’€μ λ©”λ¨λ¦¬ μ ν•μ„ μΏΌλ¦¬ μ”κµ¬μ‚¬ν•­μ— λ§κ² μ¦κ°€μ‹ν‚µλ‹λ‹¤.
ν•„μ”ν•λ©΄ ν΄λ¬μ¤ν„° λ¦¬μ†μ¤λ¥Ό ν™•μ¥ν•κ±°λ‚ Impala λ°λ¬ λ©”λ¨λ¦¬ μ ν•μ„ λλ¦½λ‹λ‹¤.
μ¶”κ°€ μ§λ¬Έμ΄ μμΌλ©΄ μ•λ ¤μ£Όμ„Έμ”! π


2/2

λ‚μ λ§:
mem_limit μ„¤μ •μ„ μ¬λ ¤λ„ λ‘κ°™μ€ μ—λ¬κ°€ λ‚λ”λ° ν•΄κ²°ν•  λ°©λ²•μ΄ μμ–΄?
ChatGPTμ λ§:
ChatGPT
Impalaμ—μ„ mem_limit μ„¤μ •μ„ μ¬λ Έμμ—λ„ κ°™μ€ μ—λ¬κ°€ λ°μƒν•λ‹¤λ©΄, λ¬Έμ λ” λ‹¨μν λ°λ¬μ λ©”λ¨λ¦¬ μ ν•μ΄λ‚ λ¦¬μ†μ¤ ν’€ μ„¤μ • μ™Έμ λ‹¤λ¥Έ μ”μΈμΌ κ°€λ¥μ„±μ΄ λ†’μµλ‹λ‹¤. μ•„λ λ‹¨κ³„λ¥Ό μμ„λ€λ΅ λ”°λΌκ°€λ©° λ¬Έμ λ¥Ό ν•΄κ²°ν•΄ λ³΄μ„Έμ”.

1. μΏΌλ¦¬μ λ©”λ¨λ¦¬ μμ•½ κµ¬μ΅° ν™•μΈ
Impalaλ” ν΄λ¬μ¤ν„° μ „μ²΄ λ©”λ¨λ¦¬ μμ•½κ³Ό κ°λ³„ λ…Έλ“μ λ©”λ¨λ¦¬ μμ•½μ„ ν•¨κ» κ³ λ ¤ν•©λ‹λ‹¤. μ¦‰, νΉμ • μΏΌλ¦¬κ°€ λ©”λ¨λ¦¬λ¥Ό μ κ² μ‚¬μ©ν•λ” λ…Έλ“μ—μ„λ„ ν΄λ¬μ¤ν„° μ „μ²΄λ΅ μ”κµ¬λλ” μ΄λ‰μ΄ μ΄κ³Όν•λ©΄ μ‹¤ν–‰λμ§€ μ•μ„ μ μμµλ‹λ‹¤.

Query Profile λ¶„μ„:
Impala Web UIμ—μ„ μΏΌλ¦¬ ν”„λ΅νμΌμ„ ν™•μΈν•κ³  Minimum Memory Reservation λ° Per Node Memory κ°’μ„ λ¶„μ„ν•μ„Έμ”.
νΉμ • λ…Έλ“μ—μ„ κ³Όλ„ν• λ©”λ¨λ¦¬κ°€ μ”μ²­λλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
2. λ¦¬μ†μ¤ ν’€μ μΏΌλ¦¬ λ™μ‹ μ‹¤ν–‰ μ μ ν•
λ¦¬μ†μ¤ ν’€ λ‚΄μ—μ„ λ™μ‹ μ‹¤ν–‰λλ” μΏΌλ¦¬κ°€ λ§λ‹¤λ©΄, λ©”λ¨λ¦¬ λ¶„λ°° λ¶€μ΅±μΌλ΅ μΈν•΄ λ¬Έμ κ°€ λ°μƒν•  μ μμµλ‹λ‹¤.

ν„μ¬ λ™μ‹ μ‹¤ν–‰ μ ν• ν™•μΈ:

sql
μ½”λ“ λ³µμ‚¬
SHOW POOL CONFIGS 'root.default';
μ¶λ ¥μ—μ„ max_running_queries κ°’μ„ ν™•μΈν•μ„Έμ”.

λ™μ‹ μ‹¤ν–‰ μ μ¤„μ΄κΈ°:

sql
μ½”λ“ λ³µμ‚¬
ALTER RESOURCE POOL root.default SET max_running_queries=5;
λ™μ‹ μ‹¤ν–‰ μλ¥Ό μ¤„μ΄λ©΄ κ°λ³„ μΏΌλ¦¬κ°€ λ” λ§μ€ λ©”λ¨λ¦¬λ¥Ό μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

3. PARALLEL_EXECUTION μ„¤μ • μ΅°μ •
Impala μΏΌλ¦¬λ” κΈ°λ³Έμ μΌλ΅ λ³‘λ ¬ μ²λ¦¬λ¥Ό μ‚¬μ©ν•μ—¬ μ„±λ¥μ„ μµμ ν™”ν•©λ‹λ‹¤. κ·Έλ¬λ‚ λ³‘λ ¬ μ²λ¦¬λ΅ μΈν•΄ λ©”λ¨λ¦¬ μ†λΉ„κ°€ μ¦κ°€ν•  μ μμµλ‹λ‹¤.

μΏΌλ¦¬μ λ³‘λ ¬λ„ λ‚®μ¶”κΈ°:

μΏΌλ¦¬μ—μ„ SET NUM_SCANNER_THREADSλ¥Ό μ‚¬μ©ν•΄ λ³‘λ ¬ μ¤μΊλ„ μλ¥Ό μ ν•ν•©λ‹λ‹¤:
sql
μ½”λ“ λ³µμ‚¬
SET NUM_SCANNER_THREADS=4;
κΈ°λ³Έκ°’μ€ 0(μλ™)μ΄λ©°, κ°’μ„ μ¤„μ΄λ©΄ λ©”λ¨λ¦¬ μ‚¬μ©λ‰μ΄ κ°μ†ν•  μ μμµλ‹λ‹¤.
μΏΌλ¦¬ μμ¤€μ—μ„ λ©”λ¨λ¦¬ μ ν•: μΏΌλ¦¬ μ‹¤ν–‰ μ „μ— SET MEM_LIMITλ¥Ό λ‚®μ¶”μ–΄ μ‹¤ν–‰ν•΄λ³΄μ„Έμ”:

sql
μ½”λ“ λ³µμ‚¬
SET MEM_LIMIT=500GB;
μ΄ μ„¤μ •μ€ νΉμ • μΏΌλ¦¬μ—μ„λ§ μ μ©λ©λ‹λ‹¤.

4. μΏΌλ¦¬ μµμ ν™”
λ©”λ¨λ¦¬ λ¶€μ΅± λ¬Έμ λ” μΏΌλ¦¬ κµ¬μ΅°λ¥Ό κ°μ„ ν•΄ ν•΄κ²°ν•  μλ„ μμµλ‹λ‹¤.

JOIN μ „λµ:

EXPLAIN λ…λ Ήμ–΄λ¥Ό μ‚¬μ©ν•μ—¬ Join μ „λµμ΄ μ μ ν•μ§€ ν™•μΈν•©λ‹λ‹¤. ν•„μ”ν•λ©΄ Broadcast Joinμ—μ„ Partitioned JoinμΌλ΅ μ „ν™ν•κ±°λ‚ κ·Έ λ°λ€λ΅ μ΅°μ •ν•©λ‹λ‹¤:
sql
μ½”λ“ λ³µμ‚¬
SELECT /* +BROADCAST */ ... 
Intermediate λ°μ΄ν„° ν¬κΈ° μ¤„μ΄κΈ°:

μ¤‘κ°„ λ°μ΄ν„°κ°€ λ„λ¬΄ μ»¤μ„ λ©”λ¨λ¦¬κ°€ λ¶€μ΅±ν• κ²½μ°, ν•„μ” μ—†λ” μ»¬λΌμ„ μ κ±°ν•κ±°λ‚, λ°μ΄ν„°λ¥Ό μ‚¬μ „ μ§‘κ³„(Pre-Aggregation)ν•λ” λ°©λ²•μ„ κ³ λ ¤ν•μ„Έμ”.
5. Impala μ„¤μ • μ΅°μ •
Impalaμ κΈ€λ΅λ² μ„¤μ • μ¤‘ λ©”λ¨λ¦¬ μμ•½μ— μν–¥μ„ μ¤„ μ μλ” μ£Όμ” μµμ…μ„ ν™•μΈν•κ³  μμ •ν•©λ‹λ‹¤.

QUERY_MEM_LIMIT

μΏΌλ¦¬μ—μ„ μ „μ—­ λ©”λ¨λ¦¬ μ ν• κ°’μ„ μ„¤μ •ν•©λ‹λ‹¤:
sql
μ½”λ“ λ³µμ‚¬
SET QUERY_MEM_LIMIT=1TB;
RESERVATION_LIMIT

μμ•½ λ©”λ¨λ¦¬λ¥Ό λλ ¤ ν΄λ¬μ¤ν„°κ°€ μΏΌλ¦¬λ¥Ό μμ©ν•  μ μλ„λ΅ ν•©λ‹λ‹¤:
sql
μ½”λ“ λ³µμ‚¬
SET RESERVATION_LIMIT=1TB;
6. ν΄λ¬μ¤ν„° μμ› ν™•μ¥
ν„μ¬ ν΄λ¬μ¤ν„°κ°€ μ „μ²΄μ μΌλ΅ λ©”λ¨λ¦¬κ°€ λ¶€μ΅±ν• κ²½μ°, μ•„λ μµμ…μ„ κ²€ν† ν•©λ‹λ‹¤.

λ…Έλ“ μ¶”κ°€: ν΄λ¬μ¤ν„°μ— μƒλ΅μ΄ λ…Έλ“λ¥Ό μ¶”κ°€ν•΄ μ „μ²΄ λ©”λ¨λ¦¬ μ©λ‰μ„ λλ¦½λ‹λ‹¤.

λ°λ¬ λ©”λ¨λ¦¬ λ¦¬μ†μ¤ μ¬μ΅°μ •: Cloudera Managerμ—μ„ Impala Daemon Memory Limitμ„ μ΅°μ •ν•μ—¬ Impalaκ°€ μ‚¬μ©ν•  μ μλ” λ©”λ¨λ¦¬λ¥Ό λλ¦½λ‹λ‹¤.

7. μ¶”κ°€ λ¬Έμ  ν™•μΈ
μ¤μΌ€μ¤„λ§ λ¬Έμ :

λ‹¤λ¥Έ λ¦¬μ†μ¤ ν’€μ΄λ‚ μΏΌλ¦¬κ°€ λ™μ‹μ— λ§μ€ μμ›μ„ μ‚¬μ©ν•λ” κ²½μ°, μ¤μΌ€μ¤„λ§ μ΄μμΌ μ μμµλ‹λ‹¤. ν•„μ”ν•λ‹¤λ©΄ Admission Control λ΅κ·Έλ¥Ό λ¶„μ„ν•΄ λ³‘λ© ν„μƒμ„ ν™•μΈν•©λ‹λ‹¤.
μΏΌλ¦¬ μ¬μ‹λ„:

μΌλ¶€ λ©”λ¨λ¦¬ λ¶€μ΅± μ΄μλ” μΌμ‹μ μΈ λ¦¬μ†μ¤ κ²½μμΌλ΅ μΈν•΄ λ°μƒν•©λ‹λ‹¤. λ™μΌν• μΏΌλ¦¬λ¥Ό λ‹¤μ‹ μ‹¤ν–‰ν•΄ λ³΄μ„Έμ”.
μ”μ•½
μΏΌλ¦¬μ λ©”λ¨λ¦¬ μ”κµ¬μ‚¬ν•­ λ¶„μ„ λ° μµμ ν™”.
λ¦¬μ†μ¤ ν’€ λ™μ‹ μ‹¤ν–‰ μ ν• μ΅°μ •.
λ³‘λ ¬ μ‹¤ν–‰ λ° μΏΌλ¦¬ λ©”λ¨λ¦¬ μ ν• μ„¤μ •.
ν΄λ¬μ¤ν„° μμ› ν™•μ¥ κ³ λ ¤.
Impala μ„¤μ • μ „λ° κ²€ν† .
μ„ λ‹¨κ³„λ¥Ό μ μ©ν•΄λ„ ν•΄κ²°λμ§€ μ•λ”λ‹¤λ©΄ μΏΌλ¦¬ ν”„λ΅νμΌ μ •λ³΄λ¥Ό μ κ³µν•΄ μ£Όμ‹λ©΄, λ³΄λ‹¤ κµ¬μ²΄μ μΌλ΅ λ„μ™€λ“λ¦΄ μ μμµλ‹λ‹¤! π
