
ì•„ë˜ëŠ” Grafana 25.x(=Grafana 10.x) ê¸°ì¤€ìœ¼ë¡œ
API Tokenì„ ìƒì„± / ê°±ì‹ (ì¬ë°œê¸‰) / ì‚­ì œí•˜ëŠ” ì „ì²´ ë°©ë²•ì„ ê°€ì¥ ì •í™•í•˜ê²Œ ì •ë¦¬í•œ ë‚´ìš©ì…ë‹ˆë‹¤.

GrafanaëŠ” ê¸°ì¡´ â€œAPI Keyâ€ ë°©ì‹ì´ ì—†ì–´ì§€ê³ ,
â¡ï¸ Service Account + Token êµ¬ì¡°ë¡œ ì™„ì „íˆ ë³€ê²½ë¨.


---

âœ… 1. Service Account Token ìƒì„±(ë°œê¸‰) ë°©ë²•

â‘  Service Account ìƒì„±

Grafana UIì—ì„œ:

1. Settings(í†±ë‹ˆë°”í€´)


2. Users & Teams


3. Service Accounts


4. New service account



ì´ë¦„: clickhouse-api

Role ì„ íƒ:

Viewer: ì½ê¸°ë§Œ í•„ìš”í•  ë•Œ

Editor: íŒ¨ë„/ì¿¼ë¦¬ ìˆ˜ì • í•„ìš” ì‹œ

Admin: ì „ì²´ ê´€ë¦¬ (í•„ìš”í•  ë•Œë§Œ)



â‘¡ Token ìƒì„±

Service Account í˜ì´ì§€ â†’ Add token

Token name: clickhouse-token

Expires: í•„ìš” ì‹œ No expiration

Create token í´ë¦­


ğŸ‘‰ ìƒì„±ëœ í† í° ë¬¸ìì—´ì€ í•œ ë²ˆë§Œ í‘œì‹œë¨
ê¼­ ë³µì‚¬í•´ë‘ì–´ì•¼ í•¨.


---

ğŸ”¥ 2. APIë¡œ Token ìƒì„±(ìë™í™”)

í† í° ë°œê¸‰ë„ REST APIë¡œ ê°€ëŠ¥í•¨.

Service Account ID ì¡°íšŒ

curl -H "Authorization: Bearer ADMIN_TOKEN" \
     http://localhost:3000/api/serviceaccounts/search

ì¶œë ¥ ì˜ˆ:

{
  "serviceAccounts": [
    {
      "id": 7,
      "name": "clickhouse-api",
      "role": "Viewer"
    }
  ]
}

ì—¬ê¸°ì„œ id=7 ì‚¬ìš©.


---

âœ” Token ìƒì„± API

curl -X POST \
     -H "Authorization: Bearer ADMIN_TOKEN" \
     -H "Content-Type: application/json" \
     -d '{"name": "clickhouse-token", "secondsToLive": 0}' \
     http://localhost:3000/api/serviceaccounts/7/tokens

"secondsToLive": 0 â†’ ë§Œë£Œ ì—†ìŒ

ë§Œë£Œë¥¼ ì¤„ ê²½ìš° 7ì¼: "secondsToLive": 604800


ì‘ë‹µ

{
  "name": "clickhouse-token",
  "key": "eyJrIjoiQ...AAA"
}

ì—¬ê¸°ì„œ "key" ê°€ ì‹¤ì œ ì‚¬ìš©í•  Bearer Token


---

ğŸ” 3. Token ê°±ì‹ (ì¬ë°œê¸‰) ë°©ë²•

GrafanaëŠ” Tokenì„ ê°±ì‹ í•˜ëŠ” APIê°€ ì—†ìŒ.
ğŸ‘‰ ì¦‰, ê¸°ì¡´ í† í°ì„ **Rotate(ì‚­ì œ í›„ ì¬ë°œê¸‰)**í•˜ëŠ” ë°©ì‹ë§Œ ê°€ëŠ¥.

ê°±ì‹  ì ˆì°¨:

1. ê¸°ì¡´ Token ID ì¡°íšŒ


2. ê¸°ì¡´ Token ì‚­ì œ


3. ìƒˆ Token ìƒì„±




---

âœ” 3-1. ê¸°ì¡´ í† í° ëª©ë¡ ì¡°íšŒ

curl -H "Authorization: Bearer ADMIN_TOKEN" \
     http://localhost:3000/api/serviceaccounts/7/tokens

ì˜ˆì‹œ ì¶œë ¥:

[
  {
    "id": 12,
    "name": "clickhouse-token",
    "secondsToLive": 0
  }
]


---

âœ” 3-2. Token ì‚­ì œ (ê°±ì‹  ì‹œ ë°˜ë“œì‹œ ì‚¬ìš©)

curl -X DELETE \
     -H "Authorization: Bearer ADMIN_TOKEN" \
     http://localhost:3000/api/serviceaccounts/7/tokens/12

tokens/12 â†’ ì‚­ì œí•  Token ID


---

âœ” 3-3. ìƒˆ Token ì¬ë°œê¸‰

ìœ„ì˜ Token ìƒì„± API ë‹¤ì‹œ ì‹¤í–‰


---

ğŸ—‘ 4. Token ì‚­ì œ ë°©ë²• (UI)

Grafana UI â†’
Users & Teams â†’ Service Accounts â†’ í•´ë‹¹ ê³„ì • â†’ Tokens â†’ Delete


---

ğŸ—‘ 5. Token ì‚­ì œ ë°©ë²• (API)

Token ID í™•ì¸ í›„:

curl -X DELETE \
     -H "Authorization: Bearer ADMIN_TOKEN" \
     http://localhost:3000/api/serviceaccounts/7/tokens/12


---

ğŸ“Œ 6. Token ì‚¬ìš©í•´ì„œ ClickHouse ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°(curl)

Grafana ClickHouse Plugin ì„¤ì¹˜ í›„,
í…ŒìŠ¤íŠ¸ ê²¸ ê°„ë‹¨í•œ ì¿¼ë¦¬ë¥¼ APIë¡œ ë¶ˆëŸ¬ì˜¤ë ¤ë©´:

(1) Flux/JSON Query API ì‚¬ìš©

Grafana ê³µì‹ Query API ê²½ë¡œ:

/api/ds/query

(2) ë°ì´í„°ì†ŒìŠ¤ ID í™•ì¸

curl -H "Authorization: Bearer YOUR_TOKEN" \
     http://localhost:3000/api/datasources

ì¶œë ¥ ì˜ˆ:

[
  {
    "id": 4,
    "uid": "clickhouse",
    "type": "grafana-clickhouse-datasource"
  }
]

ì—¬ê¸°ì„œ ë°ì´í„°ì†ŒìŠ¤ IDëŠ” 4


---

(3) ClickHouse ë°ì´í„° ì¡°íšŒ ìš”ì²­

curl -X POST \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
        "queries": [
          {
            "datasourceId": 4,
            "rawSql": "SELECT number FROM system.numbers LIMIT 5",
            "format": "table"
          }
        ]
      }' \
  http://localhost:3000/api/ds/query

ì‘ë‹µ ì˜ˆì‹œ

{
  "results": {
    "A": {
      "frames": [
        {
          "schema": {...},
          "data": {
            "values": [[0,1,2,3,4]]
          }
        }
      ]
    }
  }
}

ì¦‰, Grafana Token â†’ API â†’ ClickHouse ì¿¼ë¦¬ ìˆ˜í–‰
ëª¨ë‘ ì •ìƒ ë™ì‘!


---

ğŸ”¥ í•„ìš”í•˜ë©´ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ë„ ë§Œë“¤ì–´ë“œë¦½ë‹ˆë‹¤

í† í° ìë™ ìƒì„±/ì‚­ì œ Bash ìŠ¤í¬ë¦½íŠ¸

Token íšŒì „(rotate) ìë™í™”

ClickHouse ì¿¼ë¦¬ ìë™í™” ìŠ¤í¬ë¦½íŠ¸

Impala / Spark / Kafka í†µí•© API ìŠ¤í¬ë¦½íŠ¸


ì›í•˜ë©´ ë°”ë¡œ ë§Œë“¤ì–´ì¤„ê²Œ.
