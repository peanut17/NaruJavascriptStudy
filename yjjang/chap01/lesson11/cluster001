
Ubuntu ì„œë²„ ë‘ ëŒ€(A ì„œë²„, B ì„œë²„)ì— ClickHouseë¥¼ ì„¤ì¹˜í•˜ê³  í´ëŸ¬ìŠ¤í„°ë§í•˜ì—¬ ë°ì´í„°ë¥¼ ë¶„ì‚° ì €ì¥í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ì„¤ëª…í• ê²Œ.


---

1. ClickHouse ì„¤ì¹˜ (A ì„œë²„, B ì„œë²„)

ê° ì„œë²„ì—ì„œ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ ClickHouseë¥¼ ì„¤ì¹˜í•œë‹¤.

sudo apt-get update
sudo apt-get install -y clickhouse-server clickhouse-client

ì„¤ì¹˜ í›„ ClickHouse ì„œë²„ë¥¼ ì‹œì‘í•œë‹¤.

sudo systemctl start clickhouse-server
sudo systemctl enable clickhouse-server


---

2. í´ëŸ¬ìŠ¤í„° ì„¤ì • (A ì„œë²„, B ì„œë²„ ê³µí†µ)

ClickHouse ì„¤ì • íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•œë‹¤.

ì„¤ì • íŒŒì¼ í¸ì§‘:

sudo nano /etc/clickhouse-server/config.xml

ì•„ë˜ì™€ ê°™ì´ <remote_servers> ì„¤ì •ì„ ì¶”ê°€í•œë‹¤.

<remote_servers>
    <my_cluster>
        <shard>
            <replica>
                <host>Aì„œë²„_IP</host>
                <port>9000</port>
            </replica>
            <replica>
                <host>Bì„œë²„_IP</host>
                <port>9000</port>
            </replica>
        </shard>
    </my_cluster>
</remote_servers>

ì„¤ì • ì ìš©ì„ ìœ„í•´ ClickHouseë¥¼ ì¬ì‹œì‘í•œë‹¤.

sudo systemctl restart clickhouse-server


---

3. í´ëŸ¬ìŠ¤í„° ë°ì´í„°ë² ì´ìŠ¤ ë° í…Œì´ë¸” ìƒì„±

ê° ì„œë²„ì—ì„œ ë™ì¼í•œ ë¶„ì‚° í…Œì´ë¸”ì„ ìƒì„±í•´ì•¼ í•œë‹¤.

ClickHouse í´ë¼ì´ì–¸íŠ¸ ì ‘ì†:

clickhouse-client -h localhost

â‘  ìƒ¤ë“œ í…Œì´ë¸” (ê° ì„œë²„ì—ì„œ ì‹¤í–‰)

ê° ì„œë²„ì— ë¡œì»¬ í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤.

CREATE TABLE default.data_local ON CLUSTER my_cluster (
    id UInt32,
    value String
) ENGINE = MergeTree()
ORDER BY id;

â‘¡ ë¶„ì‚° í…Œì´ë¸” (ê° ì„œë²„ì—ì„œ ì‹¤í–‰)

ì´ì œ ë¶„ì‚° í…Œì´ë¸”ì„ ìƒì„±í•œë‹¤.

CREATE TABLE default.data_distributed ON CLUSTER my_cluster AS default.data_local
ENGINE = Distributed(my_cluster, default, data_local, rand());


---

4. ë°ì´í„° ë¶„ì‚° ì ì¬ í…ŒìŠ¤íŠ¸

ë°ì´í„°ë¥¼ data_distributed í…Œì´ë¸”ì— ì‚½ì…í•˜ë©´, ìë™ìœ¼ë¡œ ë‘ ì„œë²„ì— ë¶„ì‚°ëœë‹¤.

ì˜ˆì œ ë°ì´í„° ì‚½ì…:

INSERT INTO default.data_distributed VALUES (1, 'A'), (2, 'B'), (3, 'C');

ë°ì´í„° í™•ì¸:

SELECT * FROM default.data_distributed;


---

5. í´ëŸ¬ìŠ¤í„° í™•ì¸

í´ëŸ¬ìŠ¤í„°ì— ì†í•œ ë…¸ë“œ ìƒíƒœë¥¼ í™•ì¸í•œë‹¤.

SELECT * FROM system.clusters WHERE cluster='my_cluster';


---

ì´ì œ ClickHouse í´ëŸ¬ìŠ¤í„°ê°€ êµ¬ì„±ë˜ì—ˆìœ¼ë©°, data_distributed í…Œì´ë¸”ì„ í†µí•´ ë°ì´í„°ê°€ A, B ì„œë²„ë¡œ ë¶„ì‚° ì €ì¥ëœë‹¤.
ì¶”ê°€ ì„¤ì •ì´ í•„ìš”í•˜ë©´ ì•Œë ¤ì¤˜! ğŸ˜Š



Distributed í…Œì´ë¸”ì´ ì œëŒ€ë¡œ ë¶„ì‚°ë˜ì§€ ì•Šê³  ê° ë…¸ë“œ(A, B)ì— ë™ì¼í•œ ë°ì´í„°ê°€ ë“¤ì–´ê°€ëŠ” ë¬¸ì œëŠ” ë³´í†µ ë‹¤ìŒê³¼ ê°™ì€ ì›ì¸ ë•Œë¬¸ì´ì•¼.


---

ğŸ” ì›ì¸ ë° í•´ê²° ë°©ë²•

ğŸš¨ 1. Distributed í…Œì´ë¸”ì´ ë¡œì»¬ í…Œì´ë¸”ì„ ê°€ë¦¬í‚¤ëŠ”ì§€ í™•ì¸

ê° ì„œë²„(A, B)ì—ì„œ data_distributed í…Œì´ë¸”ì´ ì˜¬ë°”ë¥¸ data_local í…Œì´ë¸”ì„ ì°¸ì¡°í•˜ê³  ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•´.

ğŸ”¹ í™•ì¸ ë°©ë²• (SHOW CREATE TABLE ì‹¤í–‰)
ê° ì„œë²„ì—ì„œ ì‹¤í–‰í•˜ì—¬ data_distributed í…Œì´ë¸”ì´ data_localì„ ê°€ë¦¬í‚¤ëŠ”ì§€ í™•ì¸:

SHOW CREATE TABLE default.data_distributed;

âœ… ì •ìƒì ì¸ ê²½ìš°

CREATE TABLE default.data_distributed AS default.data_local
ENGINE = Distributed(my_cluster, default, data_local, rand());

âŒ ì˜ëª»ëœ ê²½ìš°
ë§Œì•½ data_distributedê°€ MergeTree ì—”ì§„ìœ¼ë¡œ ë˜ì–´ ìˆë‹¤ë©´ Distributed í…Œì´ë¸”ì´ ì•„ë‹ˆë¼ ë¡œì»¬ í…Œì´ë¸”ì„ ìƒì„±í•œ ê²ƒì´ë¯€ë¡œ ë‹¤ì‹œ ìƒì„±í•´ì•¼ í•¨.


---

ğŸš¨ 2. INSERT INTOë¥¼ Distributed í…Œì´ë¸”ì— í–ˆëŠ”ì§€ í™•ì¸

ë°ì´í„°ë¥¼ ë„£ì„ ë•Œ data_localì´ ì•„ë‹ˆë¼ data_distributed í…Œì´ë¸”ì— ë„£ì–´ì•¼ í•œë‹¤.

âœ… ì •í™•í•œ ë°ì´í„° ì‚½ì… ë°©ë²•

INSERT INTO default.data_distributed VALUES (1, 'A'), (2, 'B'), (3, 'C');

âŒ ì˜ëª»ëœ ë°ì´í„° ì‚½ì… (ë¶„ì‚°ë˜ì§€ ì•ŠìŒ)

INSERT INTO default.data_local VALUES (1, 'A'), (2, 'B'), (3, 'C');

data_localì— ì§ì ‘ INSERT í•˜ë©´ ê·¸ ì„œë²„ì—ë§Œ ë°ì´í„°ê°€ ë“¤ì–´ê°.

data_distributedì— INSERT í•´ì•¼ ClickHouseê°€ ë°ì´í„°ë¥¼ í´ëŸ¬ìŠ¤í„°ì— ë¶„ì‚°í•¨.



---

ğŸš¨ 3. í´ëŸ¬ìŠ¤í„° ì„¤ì •ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸

ClickHouse ì„¤ì • íŒŒì¼(/etc/clickhouse-server/config.xml)ì—ì„œ í´ëŸ¬ìŠ¤í„°ê°€ ì œëŒ€ë¡œ ì •ì˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•´.

ğŸ”¹ ì„¤ì • í™•ì¸ (ê° ì„œë²„ì—ì„œ ì‹¤í–‰)

SELECT * FROM system.clusters WHERE cluster='my_cluster';

âœ… A, B ì„œë²„ê°€ ëª¨ë‘ í‘œì‹œë˜ì–´ì•¼ í•¨

cluster    | shard_num | replica_num | host_name  | port
--------------------------------------------------------
my_cluster | 1        | 1           | Aì„œë²„_IP   | 9000
my_cluster | 1        | 2           | Bì„œë²„_IP   | 9000

âŒ B ì„œë²„ê°€ ë¹ ì ¸ ìˆë‹¤ë©´?

config.xmlì—ì„œ <remote_servers> ì„¤ì •ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ê³  ClickHouseë¥¼ ì¬ì‹œì‘í•´ì•¼ í•¨.


<remote_servers>
    <my_cluster>
        <shard>
            <replica>
                <host>Aì„œë²„_IP</host>
                <port>9000</port>
            </replica>
            <replica>
                <host>Bì„œë²„_IP</host>
                <port>9000</port>
            </replica>
        </shard>
    </my_cluster>
</remote_servers>

ğŸ”¹ ì„¤ì • ì ìš©ì„ ìœ„í•´ ClickHouse ì¬ì‹œì‘

sudo systemctl restart clickhouse-server


---

ğŸš¨ 4. INSERT ì‹œ ë¶„ì‚° ê¸°ì¤€ì´ rand()ì¸ì§€ í™•ì¸

data_distributed í…Œì´ë¸” ìƒì„± ì‹œ rand()ê°€ ë¶„ì‚° ê¸°ì¤€ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•¨.

âœ… ì •í™•í•œ ì„¤ì •

CREATE TABLE default.data_distributed AS default.data_local
ENGINE = Distributed(my_cluster, default, data_local, rand());

âŒ ì˜ëª»ëœ ì„¤ì • (ë¶„ì‚°ë˜ì§€ ì•ŠìŒ)

ENGINE = Distributed(my_cluster, default, data_local, id);

id ê°’ì´ íŠ¹ì • ë…¸ë“œë¡œë§Œ ê°€ë„ë¡ ê³ ì •ë˜ë©´ ë¶„ì‚°ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ.



---

ğŸš¨ 5. ë°ì´í„°ë¥¼ data_localì—ì„œ ì¡°íšŒí•˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸

ë°ì´í„° ì¡°íšŒ ì‹œ data_localì—ì„œ ì§ì ‘ ì¡°íšŒí•˜ë©´ ë¶„ì‚° íš¨ê³¼ë¥¼ ë³¼ ìˆ˜ ì—†ìŒ.

âœ… í´ëŸ¬ìŠ¤í„° ì „ì²´ ë°ì´í„° ì¡°íšŒ

SELECT * FROM default.data_distributed;

âŒ ì˜ëª»ëœ ì¡°íšŒ (ë¡œì»¬ í…Œì´ë¸”ì—ì„œë§Œ í™•ì¸ë¨)

SELECT * FROM default.data_local;

data_localì€ ê° ì„œë²„ì˜ ë¡œì»¬ ë°ì´í„°ë§Œ ë³´ì—¬ì¤Œ.

data_distributedì—ì„œ ì¡°íšŒí•´ì•¼ A, B ì„œë²„ì— ë¶„ì‚°ëœ ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆìŒ.



---

âœ… ìµœì¢… ì ê²€ ë¦¬ìŠ¤íŠ¸

1. data_distributed í…Œì´ë¸”ì´ Distributed ì—”ì§„ì¸ì§€ SHOW CREATE TABLEë¡œ í™•ì¸ âœ…


2. INSERT INTO default.data_distributedë¡œ ë°ì´í„°ë¥¼ ë„£ì—ˆëŠ”ì§€ í™•ì¸ âœ…


3. system.clustersì—ì„œ A, B ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸ âœ…


4. data_distributed í…Œì´ë¸”ì´ rand()ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë¬´ì‘ìœ„ë¡œ ë¶„ì‚°í•˜ëŠ”ì§€ í™•ì¸ âœ…


5. ë°ì´í„°ë¥¼ data_localì´ ì•„ë‹ˆë¼ data_distributedì—ì„œ ì¡°íšŒí–ˆëŠ”ì§€ í™•ì¸ âœ…



ì´ì œ ë‹¤ì‹œ í™•ì¸í•´ë³´ê³ ë„ ë¬¸ì œê°€ ìˆìœ¼ë©´ ì•Œë ¤ì¤˜! ğŸ˜Š

